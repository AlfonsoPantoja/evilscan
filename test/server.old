var net = require('net');
var telnet = require('sol-telnet');

var server = function(port,cb) {
    var ts = new telnet();

    var s = net.createServer(function(sock){

        sock.pipe(ts).pipe(sock);

        // Every time you get
        ts.on('lineReceived', function(line){
            console.log(line);
            this.send("Ok there.." + line + "\n")
        })

        // Resize your telnet window and this should change.
        ts.on('clientWindowChangedSize', function(width, height) {
            console.log("NAWS:", width, height);
        })

        // Something odd...
        ts.on("unhandledCommand", function(data) {
            console.log(data);
        });
    });
    s.listen(port,cb);
    s.on('connection',function(s) {
        s.write('hello\n');
    });
    return s;
}

var srv = server(1025,function() {
    console.log('ready');
});
